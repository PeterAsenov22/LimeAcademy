<div class="heading">
  <h1 class="text-info">
    Welcome to {{title}}!
  </h1>
</div>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-3"></div>
    <div class="col-md-6">
      <form [formGroup]="checkAddressForm" (ngSubmit)="getAddressCars()">
        <legend>Enter address to check which cars belong to it</legend>
        <div class="form-group row">
          <label for="address" class="col-sm-2 col-form-label">Address</label>
          <div class="col-sm-10">
            <input 
              type="text"
              class="form-control"
              id="address"
              formControlName="address"
              [ngClass]="{ 'is-invalid': address.touched && address.errors }"
              placeholder="0x...">
              <div *ngIf="address.errors" class="invalid-feedback">
                <div *ngIf="address.errors.required">
                  Address is required.
                </div>
                <div *ngIf="address.errors.pattern">
                  Address should start with '0x' and should be exactly 42 symbols long.
                </div>
              </div>
          </div>
        </div>
        <input type="submit" class="btn btn-info" value="Check" [disabled]="checkAddressForm.invalid" />
      </form>
    </div>
  </div>
  <div *ngIf="cars" class="mt-2">
    <div class="address-spent text-center">
      <h5 class="text-info">Total amount spent by the address: {{addressTotalMoneySpent}} ETH</h5>
    </div>
    <div class="row mt-5">
      <div *ngIf="cars.length > 0; else notFound" class="ml-5 row space-top">
        <div *ngFor="let car of cars" class="card m-4">
          <div class="card-body">
            <h4 class="text-center mb-4">{{ethers.utils.parseBytes32String(car._carMake)}} {{ethers.utils.parseBytes32String(car._carModel)}}</h4>
            <p><strong>Owner:</strong> {{car._carOwner}}</p>
            <p><strong>Is Second Hand:</strong> {{car._isSecondHand ? 'Yes' : 'No'}}</p>
            <p *ngIf="car._isSecondHand"><strong>Bought For:</strong> {{ethers.utils.formatEther(car._carPrice)}} ETH</p>
            <p *ngIf="!car._isSecondHand"><strong>Bought For:</strong> N/A</p>
          </div>
          <div class="card-footer">
            <span *ngIf="car._isSecondHand" class="text-muted">Price: {{ethers.utils.formatEther(car._carPrice.mul(2))}} ETH</span>
            <span *ngIf="!car._isSecondHand" class="text-muted">Price: {{ethers.utils.formatEther(car._carPrice)}} ETH</span>
            <button 
              type="button"
              class="btn btn-warning btn-sm float-right"
              *ngIf="walletService.isWalletLoaded() && (car._carOwner !== walletService.getAddress())"
              routerLink="/cars/buy/{{car._id}}">
              Buy
            </button>
          </div>
        </div>
      </div>
      <ng-template #notFound>
        <h3 class="text-warning">The given address does not own any cars currently :(</h3>
      </ng-template>
    </div>
  </div>
</div>
